workflows:
- name: customer_successful_purchase_flow
  description: 'Complete happy path: customer logs in, finds available pet, places
    order successfully'
  category: happy_path
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet is available
    expect:
      status: 200
      body_contains:
        status: available
  - action: POST /api/v3/store/order
    description: Place order for available pet
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
        status: placed
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to pending
    expect:
      status: 200
      body_contains:
        status: pending
- name: store_owner_order_approval_flow
  description: Store owner approves and delivers an order, pet becomes sold
  category: happy_path
  steps:
  - action: GET /api/v3/user/login
    description: Login as store owner
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:store_owner_token}}'
  - action: GET /api/v3/user/login
    description: Login as customer first to create order
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Customer places order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/store/order/{{order_id}}
    description: Store owner views the order
    headers:
      Authorization: Bearer {{store_owner_token}}
    expect:
      status: 200
      body_contains:
        status: placed
- name: guest_browse_pets_successfully
  description: Guest user can browse pets and inventory without authentication
  category: happy_path
  steps:
  - action: GET /api/v3/pet/findByStatus
    description: Guest browses available pets
    query:
      status: available
    expect:
      status: 200
  - action: GET /api/v3/store/inventory
    description: Guest views store inventory
    expect:
      status: 200
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Guest views pet details
    expect:
      status: 200
      body_contains:
        status: available
- name: customer_cannot_manage_pets
  description: Customers are forbidden from adding, editing, or deleting pets
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/pet
    description: Customer tries to add pet - should be forbidden
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      name: Fluffy
      category:
        name: Cat
      status: available
    expect:
      status: 403
  - action: PUT /api/v3/pet
    description: Customer tries to edit pet - should be forbidden
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      id: '{{available_pet_id}}'
      name: Updated Name
      status: available
    expect:
      status: 403
  - action: DELETE /api/v3/pet/{{available_pet_id}}
    description: Customer tries to delete pet - should be forbidden
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 403
- name: guest_cannot_place_orders
  description: Unauthenticated users cannot access write operations like placing orders
  category: authorization
  steps:
  - action: POST /api/v3/store/order
    description: Guest tries to place order without authentication
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 401
  - action: POST /api/v3/user
    description: Guest tries to create user without authentication
    body:
      username: newuser
      email: test@example.com
    expect:
      status: 401
- name: customer_ownership_check_orders
  description: Customers can only view and cancel their own orders, not others'
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: Login as first customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer1_token}}'
  - action: POST /api/v3/store/order
    description: First customer places order
    headers:
      Authorization: Bearer {{customer1_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:customer1_order_id}}'
  - action: GET /api/v3/user/login
    description: Login as different customer
    query:
      username: customer2
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer2_token}}'
  - action: GET /api/v3/store/order/{{customer1_order_id}}
    description: Second customer tries to view first customer's order - should be
      forbidden
    headers:
      Authorization: Bearer {{customer2_token}}
    expect:
      status: 403
  - action: DELETE /api/v3/store/order/{{customer1_order_id}}
    description: Second customer tries to cancel first customer's order - should be
      forbidden
    headers:
      Authorization: Bearer {{customer2_token}}
    expect:
      status: 403
- name: user_profile_ownership_check
  description: Users can only view and edit their own profile, not others'
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: GET /api/v3/user/{{store_owner_username}}
    description: Customer tries to view store owner profile - should be forbidden
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 403
  - action: PUT /api/v3/user/{{store_owner_username}}
    description: Customer tries to edit store owner profile - should be forbidden
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      firstName: Hacker
      email: hacker@evil.com
    expect:
      status: 403
  - action: GET /api/v3/user/{{customer_username}}
    description: Customer can view own profile
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 200
- name: cannot_order_unavailable_pet
  description: Validation prevents ordering pets that are not available
  category: validation
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Try to order pending pet - should fail
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{pending_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 400
      body_contains:
        message: Pet is not available for purchase
  - action: POST /api/v3/store/order
    description: Try to order sold pet - should fail
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{sold_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 400
      body_contains:
        message: Pet is not available for purchase
- name: quantity_must_be_one
  description: Order quantity must be exactly 1 for live animals
  category: validation
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Try to order with quantity 0 - should fail
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 0
      status: placed
    expect:
      status: 400
      body_contains:
        message: Quantity must be 1 for live animals
  - action: POST /api/v3/store/order
    description: Try to order with quantity 2 - should fail
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 2
      status: placed
    expect:
      status: 400
      body_contains:
        message: Quantity must be 1 for live animals
- name: only_admin_can_relist_sold_pets
  description: Only admin role can change pet status from sold back to available
  category: validation
  steps:
  - action: GET /api/v3/user/login
    description: Login as store owner
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:store_owner_token}}'
  - action: PUT /api/v3/pet
    description: Store owner tries to relist sold pet - should fail
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      id: '{{sold_pet_id}}'
      name: Relisted Pet
      status: available
    expect:
      status: 403
      body_contains:
        message: Only admin can relist sold pets
  - action: GET /api/v3/user/login
    description: Login as admin
    query:
      username: '{{admin_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:admin_token}}'
  - action: PUT /api/v3/pet
    description: Admin can relist sold pet - should succeed
    headers:
      Authorization: Bearer {{admin_token}}
    body:
      id: '{{sold_pet_id}}'
      name: Relisted Pet
      status: available
    expect:
      status: 200
      body_contains:
        status: available
- name: order_creation_changes_pet_to_pending
  description: When order is placed, pet status automatically changes to pending
  category: state_transition
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet starts as available
    expect:
      status: 200
      body_contains:
        status: available
  - action: POST /api/v3/store/order
    description: Place order for available pet
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to pending
    expect:
      status: 200
      body_contains:
        status: pending
- name: order_cancellation_returns_pet_to_available
  description: When placed order is cancelled, pet status returns to available
  category: state_transition
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Place order for available pet
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet is pending after order
    expect:
      status: 200
      body_contains:
        status: pending
  - action: DELETE /api/v3/store/order/{{order_id}}
    description: Customer cancels their placed order
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 200
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status returned to available
    expect:
      status: 200
      body_contains:
        status: available
- name: cannot_delete_pet_with_active_orders
  description: Pre-condition check prevents deleting pets that have active orders
  category: error_handling
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Place order to make pet have active order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/user/login
    description: Login as store owner
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:store_owner_token}}'
  - action: DELETE /api/v3/pet/{{available_pet_id}}
    description: Store owner tries to delete pet with active order - should fail
    headers:
      Authorization: Bearer {{store_owner_token}}
    expect:
      status: 400
      body_contains:
        message: Cannot delete pet with active orders
- name: cannot_cancel_non_placed_orders
  description: Orders can only be cancelled if they have 'placed' status
  category: error_handling
  steps:
  - action: GET /api/v3/user/login
    description: Login as customer
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        sessionToken: '{{save:customer_token}}'
  - action: DELETE /api/v3/store/order/999999
    description: Try to cancel non-existent or delivered order - should fail
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 400
