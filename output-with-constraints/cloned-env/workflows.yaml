workflows:
- name: customer_successful_purchase_flow
  description: 'Happy path: Customer logs in, browses pets, places order for available
    pet'
  category: happy_path
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Customer views available pet
    expect:
      status: 200
      body_contains:
        id: '{{available_pet_id}}'
        status: available
  - action: POST /api/v3/store/order
    description: Customer places order for available pet
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        petId: '{{available_pet_id}}'
        quantity: 1
        status: placed
        id: '{{save:order_id}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to pending
    expect:
      status: 200
      body_contains:
        status: pending
- name: store_owner_order_approval_flow
  description: 'Happy path: Store owner approves and delivers customer order'
  category: happy_path
  steps:
  - action: GET /api/v3/user/login
    description: Store owner logs in
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:store_owner_token}}'
  - action: GET /api/v3/user/login
    description: Customer logs in to place order
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Customer places order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: PUT /api/v3/store/order/{{order_id}}
    description: Store owner approves order
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      status: approved
    expect:
      status: 200
      body_contains:
        status: approved
  - action: PUT /api/v3/store/order/{{order_id}}
    description: Store owner marks order as delivered
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      status: delivered
    expect:
      status: 200
      body_contains:
        status: delivered
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to sold
    expect:
      status: 200
      body_contains:
        status: sold
- name: admin_pet_management_flow
  description: 'Happy path: Admin creates pet, manages inventory, and re-lists sold
    pet'
  category: happy_path
  steps:
  - action: GET /api/v3/user/login
    description: Admin logs in
    query:
      username: '{{admin_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:admin_token}}'
  - action: POST /api/v3/pet
    description: Admin creates new pet
    headers:
      Authorization: Bearer {{admin_token}}
    body:
      name: Test Dog
      status: available
      category:
        id: 1
        name: Dogs
      photoUrls:
      - https://example.com/dog.jpg
    expect:
      status: 200
      body_contains:
        name: Test Dog
        status: available
        id: '{{save:new_pet_id}}'
  - action: PUT /api/v3/pet
    description: Admin changes sold pet back to available
    headers:
      Authorization: Bearer {{admin_token}}
    body:
      id: '{{sold_pet_id}}'
      name: Previously Sold Pet
      status: available
      category:
        id: 1
        name: Dogs
      photoUrls:
      - https://example.com/dog.jpg
    expect:
      status: 200
      body_contains:
        status: available
- name: customer_cannot_manage_pets
  description: 'Authorization test: Customer cannot create, update, or delete pets'
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: POST /api/v3/pet
    description: Customer attempts to create pet (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      name: Unauthorized Pet
      status: available
      category:
        id: 1
        name: Dogs
      photoUrls:
      - https://example.com/dog.jpg
    expect:
      status: 403
  - action: PUT /api/v3/pet
    description: Customer attempts to update pet (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      id: '{{available_pet_id}}'
      name: Updated Pet Name
      status: available
      category:
        id: 1
        name: Dogs
      photoUrls:
      - https://example.com/dog.jpg
    expect:
      status: 403
  - action: DELETE /api/v3/pet/{{available_pet_id}}
    description: Customer attempts to delete pet (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 403
- name: guest_cannot_place_orders
  description: 'Authorization test: Unauthenticated users cannot place orders'
  category: authorization
  steps:
  - action: POST /api/v3/store/order
    description: Guest attempts to place order without authentication
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 401
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Guest can view pet details (allowed)
    expect:
      status: 200
      body_contains:
        id: '{{available_pet_id}}'
  - action: GET /api/v3/store/inventory
    description: Guest can view inventory (allowed)
    expect:
      status: 200
- name: customer_ownership_restrictions
  description: 'Authorization test: Customers can only view their own orders'
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: First customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer1_token}}'
  - action: POST /api/v3/store/order
    description: First customer places order
    headers:
      Authorization: Bearer {{customer1_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:customer1_order_id}}'
  - action: GET /api/v3/user/login
    description: Second customer logs in
    query:
      username: customer2
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer2_token}}'
  - action: GET /api/v3/store/order/{{customer1_order_id}}
    description: Second customer attempts to view first customer's order (should fail)
    headers:
      Authorization: Bearer {{customer2_token}}
    expect:
      status: 403
  - action: GET /api/v3/store/order/{{customer1_order_id}}
    description: First customer can view own order
    headers:
      Authorization: Bearer {{customer1_token}}
    expect:
      status: 200
      body_contains:
        id: '{{customer1_order_id}}'
- name: cannot_order_unavailable_pet
  description: 'Validation test: Cannot order pets that are not available'
  category: validation
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Attempt to order pending pet (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{pending_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 400
      body_contains:
        message: Pet is not available for purchase
  - action: POST /api/v3/store/order
    description: Attempt to order sold pet (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{sold_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 400
      body_contains:
        message: Pet is not available for purchase
- name: quantity_must_be_one
  description: 'Validation test: Order quantity must be exactly 1 for live animals'
  category: validation
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Attempt to order multiple pets (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 2
      status: placed
    expect:
      status: 400
      body_contains:
        message: Quantity must be 1 for live animals
  - action: POST /api/v3/store/order
    description: Attempt to order zero pets (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 0
      status: placed
    expect:
      status: 400
      body_contains:
        message: Quantity must be 1 for live animals
- name: pet_status_transitions_on_order_lifecycle
  description: 'State transition test: Pet status changes through order lifecycle'
  category: state_transition
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: GET /api/v3/user/login
    description: Store owner logs in
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:store_owner_token}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet is initially available
    expect:
      status: 200
      body_contains:
        status: available
  - action: POST /api/v3/store/order
    description: Customer places order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to pending after order
    expect:
      status: 200
      body_contains:
        status: pending
  - action: PUT /api/v3/store/order/{{order_id}}
    description: Store owner delivers order
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      status: delivered
    expect:
      status: 200
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet status changed to sold after delivery
    expect:
      status: 200
      body_contains:
        status: sold
- name: order_cancellation_returns_pet_to_available
  description: 'State transition test: Cancelled orders return pets to available status'
  category: state_transition
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: POST /api/v3/store/order
    description: Customer places order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet is pending
    expect:
      status: 200
      body_contains:
        status: pending
  - action: DELETE /api/v3/store/order/{{order_id}}
    description: Customer cancels order
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 200
  - action: GET /api/v3/pet/{{available_pet_id}}
    description: Verify pet returned to available after cancellation
    expect:
      status: 200
      body_contains:
        status: available
- name: cannot_delete_pet_with_active_orders
  description: 'Pre-condition test: Cannot delete pets that have active orders'
  category: error_handling
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: GET /api/v3/user/login
    description: Store owner logs in
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:store_owner_token}}'
  - action: POST /api/v3/store/order
    description: Customer places order for pet
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: DELETE /api/v3/pet/{{available_pet_id}}
    description: Attempt to delete pet with active order (should fail)
    headers:
      Authorization: Bearer {{store_owner_token}}
    expect:
      status: 400
      body_contains:
        message: Cannot delete pet with active orders
- name: store_owner_cannot_relist_sold_pets
  description: 'Authorization test: Only admin can change sold pets back to available'
  category: authorization
  steps:
  - action: GET /api/v3/user/login
    description: Store owner logs in
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:store_owner_token}}'
  - action: PUT /api/v3/pet
    description: Store owner attempts to change sold pet to available (should fail)
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      id: '{{sold_pet_id}}'
      name: Previously Sold Pet
      status: available
      category:
        id: 1
        name: Dogs
      photoUrls:
      - https://example.com/dog.jpg
    expect:
      status: 400
      body_contains:
        message: Invalid status transition. Admin required to change sold pets back
          to available.
- name: cannot_modify_delivered_orders
  description: 'Pre-condition test: Delivered orders cannot be modified or cancelled'
  category: error_handling
  steps:
  - action: GET /api/v3/user/login
    description: Customer logs in
    query:
      username: '{{customer_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:customer_token}}'
  - action: GET /api/v3/user/login
    description: Store owner logs in
    query:
      username: '{{store_owner_username}}'
      password: '{{test_password}}'
    expect:
      status: 200
      body_contains:
        token: '{{save:store_owner_token}}'
  - action: POST /api/v3/store/order
    description: Customer places order
    headers:
      Authorization: Bearer {{customer_token}}
    body:
      petId: '{{available_pet_id}}'
      quantity: 1
      status: placed
    expect:
      status: 200
      body_contains:
        id: '{{save:order_id}}'
  - action: PUT /api/v3/store/order/{{order_id}}
    description: Store owner delivers order
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      status: delivered
    expect:
      status: 200
  - action: DELETE /api/v3/store/order/{{order_id}}
    description: Attempt to cancel delivered order (should fail)
    headers:
      Authorization: Bearer {{customer_token}}
    expect:
      status: 400
      body_contains:
        message: Cannot cancel order that has been approved or delivered
  - action: PUT /api/v3/store/order/{{order_id}}
    description: Attempt to modify delivered order (should fail)
    headers:
      Authorization: Bearer {{store_owner_token}}
    body:
      status: placed
    expect:
      status: 400
      body_contains:
        message: Cannot modify delivered orders
