{
  "api_name": "Swagger Petstore - OpenAPI 3.0",
  "base_path": "/api/v3",
  "endpoints": [
    {
      "method": "PUT",
      "path": "/api/v3/pet",
      "description": "Update an existing pet by Id",
      "auth_required": true,
      "request_body": {
        "id": "integer",
        "name": "string",
        "category": {
          "id": "integer",
          "name": "string"
        },
        "photoUrls": "array of strings",
        "tags": "array of tag objects",
        "status": "string (available, pending, sold)"
      },
      "response": {
        "id": "integer",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "logic": "Updates existing pet record in database with provided data"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet",
      "description": "Add a new pet to the store",
      "auth_required": true,
      "request_body": {
        "name": "string",
        "category": {
          "id": "integer",
          "name": "string"
        },
        "photoUrls": "array of strings",
        "tags": "array of tag objects",
        "status": "string (available, pending, sold)"
      },
      "response": {
        "id": "integer",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "logic": "Creates new pet record in database and assigns auto-generated ID"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/findByStatus",
      "description": "Finds Pets by status",
      "auth_required": true,
      "query_params": [
        "status"
      ],
      "response": [
        {
          "id": "integer",
          "name": "string",
          "category": "object",
          "photoUrls": "array",
          "tags": "array",
          "status": "string"
        }
      ],
      "logic": "Queries pets table filtering by status field, returns array of matching pets"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/findByTags",
      "description": "Finds Pets by tags",
      "auth_required": true,
      "query_params": [
        "tags"
      ],
      "response": [
        {
          "id": "integer",
          "name": "string",
          "category": "object",
          "photoUrls": "array",
          "tags": "array",
          "status": "string"
        }
      ],
      "logic": "Joins pets with pet_tags and tags tables to find pets matching specified tags"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/{petId}",
      "description": "Find pet by ID",
      "auth_required": false,
      "response": {
        "id": "integer",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "logic": "Queries pets table by primary key ID, joins with categories and tags"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}",
      "description": "Updates a pet in the store with form data",
      "auth_required": true,
      "request_body": {
        "name": "string",
        "status": "string"
      },
      "logic": "Updates specific fields of existing pet record using form data"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/pet/{petId}",
      "description": "Deletes a pet",
      "auth_required": true,
      "logic": "Removes pet record from database and associated relationships"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}/uploadImage",
      "description": "uploads an image",
      "auth_required": true,
      "request_body": {
        "additionalMetadata": "string",
        "file": "binary"
      },
      "response": {
        "code": "integer",
        "type": "string",
        "message": "string"
      },
      "logic": "Stores uploaded image file and updates pet record with photo URL"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/inventory",
      "description": "Returns pet inventories by status",
      "auth_required": true,
      "response": {
        "available": "integer",
        "pending": "integer",
        "sold": "integer"
      },
      "logic": "Aggregates pets by status field, returns count for each status"
    },
    {
      "method": "POST",
      "path": "/api/v3/store/order",
      "description": "Place an order for a pet",
      "request_body": {
        "petId": "integer",
        "quantity": "integer",
        "shipDate": "string (date-time)",
        "status": "string (placed, approved, delivered)",
        "complete": "boolean"
      },
      "response": {
        "id": "integer",
        "petId": "integer",
        "quantity": "integer",
        "shipDate": "string",
        "status": "string",
        "complete": "boolean"
      },
      "logic": "Creates new order record in orders table with auto-generated ID"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/order/{orderId}",
      "description": "Find purchase order by ID",
      "response": {
        "id": "integer",
        "petId": "integer",
        "quantity": "integer",
        "shipDate": "string",
        "status": "string",
        "complete": "boolean"
      },
      "logic": "Queries orders table by primary key ID"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/store/order/{orderId}",
      "description": "Delete purchase order by ID",
      "logic": "Removes order record from orders table"
    },
    {
      "method": "POST",
      "path": "/api/v3/user",
      "description": "Create user",
      "request_body": {
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "integer"
      },
      "response": {
        "id": "integer",
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "integer"
      },
      "logic": "Creates new user record with auto-generated ID and hashed password"
    },
    {
      "method": "POST",
      "path": "/api/v3/user/createWithList",
      "description": "Creates list of users with given input array",
      "request_body": [
        {
          "username": "string",
          "firstName": "string",
          "lastName": "string",
          "email": "string",
          "password": "string",
          "phone": "string",
          "userStatus": "integer"
        }
      ],
      "response": {
        "id": "integer",
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "integer"
      },
      "logic": "Batch insert multiple user records into users table"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/login",
      "description": "Logs user into the system",
      "query_params": [
        "username",
        "password"
      ],
      "response": {
        "token": "string"
      },
      "logic": "Validates credentials against users table and generates session token"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/logout",
      "description": "Logs out current logged in user session",
      "auth_required": true,
      "logic": "Invalidates current session token"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/{username}",
      "description": "Get user by user name",
      "response": {
        "id": "integer",
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "integer"
      },
      "logic": "Queries users table by username field"
    },
    {
      "method": "PUT",
      "path": "/api/v3/user/{username}",
      "description": "Update user",
      "request_body": {
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "integer"
      },
      "logic": "Updates existing user record identified by username"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/user/{username}",
      "description": "Delete user",
      "logic": "Removes user record from users table"
    }
  ],
  "database": {
    "tables": [
      {
        "name": "pets",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL"
          },
          {
            "name": "category_id",
            "type": "INTEGER",
            "constraints": "REFERENCES categories(id)"
          },
          {
            "name": "photo_urls",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "status",
            "type": "TEXT",
            "constraints": "CHECK (status IN ('available', 'pending', 'sold'))"
          },
          {
            "name": "created_at",
            "type": "TEXT",
            "constraints": "DEFAULT CURRENT_TIMESTAMP"
          },
          {
            "name": "updated_at",
            "type": "TEXT",
            "constraints": "DEFAULT CURRENT_TIMESTAMP"
          }
        ]
      },
      {
        "name": "categories",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL UNIQUE"
          }
        ]
      },
      {
        "name": "tags",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL UNIQUE"
          }
        ]
      },
      {
        "name": "pet_tags",
        "fields": [
          {
            "name": "pet_id",
            "type": "INTEGER",
            "constraints": "REFERENCES pets(id) ON DELETE CASCADE"
          },
          {
            "name": "tag_id",
            "type": "INTEGER",
            "constraints": "REFERENCES tags(id) ON DELETE CASCADE"
          },
          {
            "name": "",
            "type": "",
            "constraints": "PRIMARY KEY (pet_id, tag_id)"
          }
        ]
      },
      {
        "name": "orders",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "pet_id",
            "type": "INTEGER",
            "constraints": "REFERENCES pets(id)"
          },
          {
            "name": "quantity",
            "type": "INTEGER",
            "constraints": "NOT NULL DEFAULT 1"
          },
          {
            "name": "ship_date",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "status",
            "type": "TEXT",
            "constraints": "CHECK (status IN ('placed', 'approved', 'delivered')) DEFAULT 'placed'"
          },
          {
            "name": "complete",
            "type": "INTEGER",
            "constraints": "DEFAULT 0"
          },
          {
            "name": "created_at",
            "type": "TEXT",
            "constraints": "DEFAULT CURRENT_TIMESTAMP"
          },
          {
            "name": "user_id",
            "type": "INTEGER",
            "constraints": "",
            "foreign_key": "users.id"
          }
        ]
      },
      {
        "name": "users",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "username",
            "type": "TEXT",
            "constraints": "NOT NULL UNIQUE"
          },
          {
            "name": "first_name",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "last_name",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "email",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "password",
            "type": "TEXT",
            "constraints": "NOT NULL"
          },
          {
            "name": "phone",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "user_status",
            "type": "INTEGER",
            "constraints": "DEFAULT 0"
          },
          {
            "name": "created_at",
            "type": "TEXT",
            "constraints": "DEFAULT CURRENT_TIMESTAMP"
          },
          {
            "name": "role",
            "type": "TEXT",
            "constraints": "",
            "default": "customer"
          }
        ]
      }
    ]
  },
  "business_requirements": {
    "schema_changes": {
      "users": {
        "add_fields": [
          {
            "name": "role",
            "type": "TEXT",
            "default": "customer",
            "reason": "Role-based access control system - guest, customer, store_owner, admin"
          }
        ]
      },
      "orders": {
        "add_fields": [
          {
            "name": "user_id",
            "type": "INTEGER",
            "foreign_key": "users.id",
            "nullable": false,
            "reason": "Track order ownership for access control and business rules"
          }
        ]
      }
    },
    "auth_config": {
      "enabled": true,
      "method": "jwt",
      "secret_env_var": "JWT_SECRET",
      "token_expiry": "24h",
      "token_payload": [
        "user_id",
        "username",
        "role"
      ],
      "password_hashing": "bcrypt",
      "login_endpoint": "GET /api/v3/user/login",
      "register_endpoint": "POST /api/v3/user",
      "auth_required_for": "write_operations",
      "auth_header": "Authorization: Bearer <token>"
    },
    "roles": {
      "guest": {
        "description": "Unauthenticated user",
        "permissions": [
          "browse_pets",
          "view_inventory",
          "find_pets_by_status",
          "find_pets_by_tags",
          "view_pet_details"
        ]
      },
      "customer": {
        "description": "Registered user who can purchase pets",
        "permissions": [
          "place_orders",
          "view_own_orders",
          "cancel_own_placed_orders",
          "view_own_profile",
          "edit_own_profile",
          "browse_pets",
          "view_inventory"
        ]
      },
      "store_owner": {
        "description": "Store employee who manages pets and orders",
        "permissions": [
          "manage_pets",
          "approve_orders",
          "mark_orders_delivered",
          "view_all_orders",
          "upload_pet_images",
          "view_all_users"
        ]
      },
      "admin": {
        "description": "System administrator with full access",
        "permissions": [
          "all_operations",
          "delete_users",
          "change_user_roles",
          "relist_sold_pets",
          "manage_users",
          "override_ownership_checks"
        ]
      }
    },
    "endpoint_auth": [
      {
        "method": "POST",
        "path": "/api/v3/pet",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can add pets"
      },
      {
        "method": "PUT",
        "path": "/api/v3/pet",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can edit pets",
        "special_checks": [
          "admin_only_for_sold_to_available_transition"
        ]
      },
      {
        "method": "DELETE",
        "path": "/api/v3/pet/{petId}",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can delete pets"
      },
      {
        "method": "POST",
        "path": "/api/v3/pet/{petId}",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can update pets with form data"
      },
      {
        "method": "POST",
        "path": "/api/v3/pet/{petId}/uploadImage",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can upload pet images"
      },
      {
        "method": "POST",
        "path": "/api/v3/store/order",
        "auth_required": true,
        "allowed_roles": [
          "customer",
          "store_owner",
          "admin"
        ],
        "reason": "Must be authenticated to place orders"
      },
      {
        "method": "GET",
        "path": "/api/v3/store/order/{orderId}",
        "auth_required": true,
        "ownership_check": {
          "resource": "order",
          "owner_field": "user_id",
          "bypass_roles": [
            "store_owner",
            "admin"
          ]
        },
        "reason": "Customers can only view their own orders"
      },
      {
        "method": "DELETE",
        "path": "/api/v3/store/order/{orderId}",
        "auth_required": true,
        "ownership_check": {
          "resource": "order",
          "owner_field": "user_id",
          "bypass_roles": [
            "store_owner",
            "admin"
          ]
        },
        "reason": "Customers can only cancel their own orders"
      },
      {
        "method": "GET",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "ownership_check": {
          "resource": "user",
          "owner_field": "username",
          "bypass_roles": [
            "admin"
          ]
        },
        "reason": "Users can only view their own profile"
      },
      {
        "method": "PUT",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "ownership_check": {
          "resource": "user",
          "owner_field": "username",
          "bypass_roles": [
            "admin"
          ]
        },
        "special_checks": [
          "admin_only_for_role_changes"
        ],
        "reason": "Users can only edit their own profile, only admin can change roles"
      },
      {
        "method": "DELETE",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "allowed_roles": [
          "admin"
        ],
        "reason": "Only admin can delete users"
      }
    ],
    "state_transitions": [
      {
        "trigger": {
          "action": "create",
          "resource": "order"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "pending"
        },
        "condition": "pet.status == 'available'",
        "reason": "Placing an order changes pet status to pending",
        "atomic": true
      },
      {
        "trigger": {
          "action": "delete",
          "resource": "order",
          "when": "status == 'placed'"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "available"
        },
        "reason": "Cancelling a placed order returns pet to available status",
        "atomic": true
      },
      {
        "trigger": {
          "action": "update",
          "resource": "order",
          "when": "status becomes 'delivered'"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "sold"
        },
        "reason": "Delivering an order marks pet as sold",
        "atomic": true
      }
    ],
    "validation_rules": [
      {
        "endpoint": "POST /api/v3/store/order",
        "validations": [
          {
            "field": "petId",
            "check": "pet.status == 'available'",
            "error": "Pet is not available for purchase",
            "status_code": 400
          },
          {
            "field": "quantity",
            "check": "value == 1",
            "error": "Quantity must be 1 for live animals",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "PUT /api/v3/pet",
        "validations": [
          {
            "field": "status",
            "check": "if changing from 'sold' to 'available' then user.role == 'admin'",
            "error": "Only admin can relist sold pets",
            "status_code": 403
          }
        ]
      },
      {
        "endpoint": "DELETE /api/v3/store/order/{orderId}",
        "validations": [
          {
            "field": "status",
            "check": "order.status == 'placed'",
            "error": "Can only cancel orders with 'placed' status",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "PUT /api/v3/user/{username}",
        "validations": [
          {
            "field": "role",
            "check": "if role field is being changed then user.role == 'admin'",
            "error": "Only admin can change user roles",
            "status_code": 403
          }
        ]
      }
    ],
    "pre_conditions": [
      {
        "endpoint": "DELETE /api/v3/pet/{petId}",
        "checks": [
          {
            "query": "SELECT COUNT(*) FROM orders WHERE pet_id = ? AND status IN ('placed', 'approved')",
            "condition": "count == 0",
            "error": "Cannot delete pet with active orders",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "DELETE /api/v3/user/{username}",
        "checks": [
          {
            "query": "SELECT COUNT(*) FROM orders WHERE user_id = (SELECT id FROM users WHERE username = ?) AND status IN ('placed', 'approved')",
            "condition": "count == 0",
            "error": "Cannot delete user with active orders",
            "status_code": 400
          }
        ]
      }
    ]
  },
  "auth_config": {
    "enabled": true,
    "method": "jwt",
    "secret_env_var": "JWT_SECRET",
    "token_expiry": "24h",
    "token_payload": [
      "user_id",
      "username",
      "role"
    ],
    "password_hashing": "bcrypt",
    "login_endpoint": "GET /api/v3/user/login",
    "register_endpoint": "POST /api/v3/user",
    "auth_required_for": "write_operations",
    "auth_header": "Authorization: Bearer <token>"
  },
  "roles": {
    "guest": {
      "description": "Unauthenticated user",
      "permissions": [
        "browse_pets",
        "view_inventory",
        "find_pets_by_status",
        "find_pets_by_tags",
        "view_pet_details"
      ]
    },
    "customer": {
      "description": "Registered user who can purchase pets",
      "permissions": [
        "place_orders",
        "view_own_orders",
        "cancel_own_placed_orders",
        "view_own_profile",
        "edit_own_profile",
        "browse_pets",
        "view_inventory"
      ]
    },
    "store_owner": {
      "description": "Store employee who manages pets and orders",
      "permissions": [
        "manage_pets",
        "approve_orders",
        "mark_orders_delivered",
        "view_all_orders",
        "upload_pet_images",
        "view_all_users"
      ]
    },
    "admin": {
      "description": "System administrator with full access",
      "permissions": [
        "all_operations",
        "delete_users",
        "change_user_roles",
        "relist_sold_pets",
        "manage_users",
        "override_ownership_checks"
      ]
    }
  },
  "endpoint_auth": [
    {
      "method": "POST",
      "path": "/api/v3/pet",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can add pets"
    },
    {
      "method": "PUT",
      "path": "/api/v3/pet",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can edit pets",
      "special_checks": [
        "admin_only_for_sold_to_available_transition"
      ]
    },
    {
      "method": "DELETE",
      "path": "/api/v3/pet/{petId}",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can delete pets"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can update pets with form data"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}/uploadImage",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can upload pet images"
    },
    {
      "method": "POST",
      "path": "/api/v3/store/order",
      "auth_required": true,
      "allowed_roles": [
        "customer",
        "store_owner",
        "admin"
      ],
      "reason": "Must be authenticated to place orders"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/order/{orderId}",
      "auth_required": true,
      "ownership_check": {
        "resource": "order",
        "owner_field": "user_id",
        "bypass_roles": [
          "store_owner",
          "admin"
        ]
      },
      "reason": "Customers can only view their own orders"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/store/order/{orderId}",
      "auth_required": true,
      "ownership_check": {
        "resource": "order",
        "owner_field": "user_id",
        "bypass_roles": [
          "store_owner",
          "admin"
        ]
      },
      "reason": "Customers can only cancel their own orders"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "ownership_check": {
        "resource": "user",
        "owner_field": "username",
        "bypass_roles": [
          "admin"
        ]
      },
      "reason": "Users can only view their own profile"
    },
    {
      "method": "PUT",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "ownership_check": {
        "resource": "user",
        "owner_field": "username",
        "bypass_roles": [
          "admin"
        ]
      },
      "special_checks": [
        "admin_only_for_role_changes"
      ],
      "reason": "Users can only edit their own profile, only admin can change roles"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "allowed_roles": [
        "admin"
      ],
      "reason": "Only admin can delete users"
    }
  ],
  "state_transitions": [
    {
      "trigger": {
        "action": "create",
        "resource": "order"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "pending"
      },
      "condition": "pet.status == 'available'",
      "reason": "Placing an order changes pet status to pending",
      "atomic": true
    },
    {
      "trigger": {
        "action": "delete",
        "resource": "order",
        "when": "status == 'placed'"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "available"
      },
      "reason": "Cancelling a placed order returns pet to available status",
      "atomic": true
    },
    {
      "trigger": {
        "action": "update",
        "resource": "order",
        "when": "status becomes 'delivered'"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "sold"
      },
      "reason": "Delivering an order marks pet as sold",
      "atomic": true
    }
  ],
  "validation_rules": [
    {
      "endpoint": "POST /api/v3/store/order",
      "validations": [
        {
          "field": "petId",
          "check": "pet.status == 'available'",
          "error": "Pet is not available for purchase",
          "status_code": 400
        },
        {
          "field": "quantity",
          "check": "value == 1",
          "error": "Quantity must be 1 for live animals",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "PUT /api/v3/pet",
      "validations": [
        {
          "field": "status",
          "check": "if changing from 'sold' to 'available' then user.role == 'admin'",
          "error": "Only admin can relist sold pets",
          "status_code": 403
        }
      ]
    },
    {
      "endpoint": "DELETE /api/v3/store/order/{orderId}",
      "validations": [
        {
          "field": "status",
          "check": "order.status == 'placed'",
          "error": "Can only cancel orders with 'placed' status",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "PUT /api/v3/user/{username}",
      "validations": [
        {
          "field": "role",
          "check": "if role field is being changed then user.role == 'admin'",
          "error": "Only admin can change user roles",
          "status_code": 403
        }
      ]
    }
  ],
  "pre_conditions": [
    {
      "endpoint": "DELETE /api/v3/pet/{petId}",
      "checks": [
        {
          "query": "SELECT COUNT(*) FROM orders WHERE pet_id = ? AND status IN ('placed', 'approved')",
          "condition": "count == 0",
          "error": "Cannot delete pet with active orders",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "DELETE /api/v3/user/{username}",
      "checks": [
        {
          "query": "SELECT COUNT(*) FROM orders WHERE user_id = (SELECT id FROM users WHERE username = ?) AND status IN ('placed', 'approved')",
          "condition": "count == 0",
          "error": "Cannot delete user with active orders",
          "status_code": 400
        }
      ]
    }
  ],
  "workflows": [
    {
      "name": "customer_successful_purchase_flow",
      "description": "Complete happy path: customer logs in, finds available pet, places order successfully",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet is available",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Place order for available pet",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}",
              "status": "placed"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to pending",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        }
      ]
    },
    {
      "name": "store_owner_order_approval_flow",
      "description": "Store owner approves and delivers an order, pet becomes sold",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as store owner",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer first to create order",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/store/order/{{order_id}}",
          "description": "Store owner views the order",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "placed"
            }
          }
        }
      ]
    },
    {
      "name": "guest_browse_pets_successfully",
      "description": "Guest user can browse pets and inventory without authentication",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/pet/findByStatus",
          "description": "Guest browses available pets",
          "query": {
            "status": "available"
          },
          "expect": {
            "status": 200
          }
        },
        {
          "action": "GET /api/v3/store/inventory",
          "description": "Guest views store inventory",
          "expect": {
            "status": 200
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Guest views pet details",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        }
      ]
    },
    {
      "name": "customer_cannot_manage_pets",
      "description": "Customers are forbidden from adding, editing, or deleting pets",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/pet",
          "description": "Customer tries to add pet - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "name": "Fluffy",
            "category": {
              "name": "Cat"
            },
            "status": "available"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Customer tries to edit pet - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "id": "{{available_pet_id}}",
            "name": "Updated Name",
            "status": "available"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "DELETE /api/v3/pet/{{available_pet_id}}",
          "description": "Customer tries to delete pet - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 403
          }
        }
      ]
    },
    {
      "name": "guest_cannot_place_orders",
      "description": "Unauthenticated users cannot access write operations like placing orders",
      "category": "authorization",
      "steps": [
        {
          "action": "POST /api/v3/store/order",
          "description": "Guest tries to place order without authentication",
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 401
          }
        },
        {
          "action": "POST /api/v3/user",
          "description": "Guest tries to create user without authentication",
          "body": {
            "username": "newuser",
            "email": "test@example.com"
          },
          "expect": {
            "status": 401
          }
        }
      ]
    },
    {
      "name": "customer_ownership_check_orders",
      "description": "Customers can only view and cancel their own orders, not others'",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as first customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer1_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "First customer places order",
          "headers": {
            "Authorization": "Bearer {{customer1_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:customer1_order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as different customer",
          "query": {
            "username": "customer2",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer2_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/store/order/{{customer1_order_id}}",
          "description": "Second customer tries to view first customer's order - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer2_token}}"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "DELETE /api/v3/store/order/{{customer1_order_id}}",
          "description": "Second customer tries to cancel first customer's order - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer2_token}}"
          },
          "expect": {
            "status": 403
          }
        }
      ]
    },
    {
      "name": "user_profile_ownership_check",
      "description": "Users can only view and edit their own profile, not others'",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/{{store_owner_username}}",
          "description": "Customer tries to view store owner profile - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "PUT /api/v3/user/{{store_owner_username}}",
          "description": "Customer tries to edit store owner profile - should be forbidden",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "firstName": "Hacker",
            "email": "hacker@evil.com"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "GET /api/v3/user/{{customer_username}}",
          "description": "Customer can view own profile",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 200
          }
        }
      ]
    },
    {
      "name": "cannot_order_unavailable_pet",
      "description": "Validation prevents ordering pets that are not available",
      "category": "validation",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Try to order pending pet - should fail",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{pending_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Pet is not available for purchase"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Try to order sold pet - should fail",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{sold_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Pet is not available for purchase"
            }
          }
        }
      ]
    },
    {
      "name": "quantity_must_be_one",
      "description": "Order quantity must be exactly 1 for live animals",
      "category": "validation",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Try to order with quantity 0 - should fail",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 0,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Quantity must be 1 for live animals"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Try to order with quantity 2 - should fail",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 2,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Quantity must be 1 for live animals"
            }
          }
        }
      ]
    },
    {
      "name": "only_admin_can_relist_sold_pets",
      "description": "Only admin role can change pet status from sold back to available",
      "category": "validation",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as store owner",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Store owner tries to relist sold pet - should fail",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "id": "{{sold_pet_id}}",
            "name": "Relisted Pet",
            "status": "available"
          },
          "expect": {
            "status": 403,
            "body_contains": {
              "message": "Only admin can relist sold pets"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as admin",
          "query": {
            "username": "{{admin_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:admin_token}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Admin can relist sold pet - should succeed",
          "headers": {
            "Authorization": "Bearer {{admin_token}}"
          },
          "body": {
            "id": "{{sold_pet_id}}",
            "name": "Relisted Pet",
            "status": "available"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        }
      ]
    },
    {
      "name": "order_creation_changes_pet_to_pending",
      "description": "When order is placed, pet status automatically changes to pending",
      "category": "state_transition",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet starts as available",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Place order for available pet",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to pending",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        }
      ]
    },
    {
      "name": "order_cancellation_returns_pet_to_available",
      "description": "When placed order is cancelled, pet status returns to available",
      "category": "state_transition",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Place order for available pet",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet is pending after order",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        },
        {
          "action": "DELETE /api/v3/store/order/{{order_id}}",
          "description": "Customer cancels their placed order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 200
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status returned to available",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        }
      ]
    },
    {
      "name": "cannot_delete_pet_with_active_orders",
      "description": "Pre-condition check prevents deleting pets that have active orders",
      "category": "error_handling",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Place order to make pet have active order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as store owner",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "DELETE /api/v3/pet/{{available_pet_id}}",
          "description": "Store owner tries to delete pet with active order - should fail",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Cannot delete pet with active orders"
            }
          }
        }
      ]
    },
    {
      "name": "cannot_cancel_non_placed_orders",
      "description": "Orders can only be cancelled if they have 'placed' status",
      "category": "error_handling",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Login as customer",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "sessionToken": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "DELETE /api/v3/store/order/999999",
          "description": "Try to cancel non-existent or delivered order - should fail",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 400
          }
        }
      ]
    }
  ]
}