{
  "api_name": "Swagger Petstore API",
  "base_path": "/api/v3",
  "endpoints": [
    {
      "method": "PUT",
      "path": "/api/v3/pet",
      "description": "Update an existing pet",
      "request_body": {
        "id": "number",
        "name": "string",
        "category": {
          "id": "number",
          "name": "string"
        },
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "response": {
        "id": "number",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "auth_required": true,
      "logic": "Updates existing pet record in database, validates pet exists and user has permission"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet",
      "description": "Add a new pet to the store",
      "request_body": {
        "name": "string",
        "category": {
          "id": "number",
          "name": "string"
        },
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "response": {
        "id": "number",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "auth_required": true,
      "logic": "Creates new pet record, handles category and tag relationships, generates auto-increment ID"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/findByStatus",
      "description": "Finds pets by status",
      "query_params": [
        "status"
      ],
      "response": {
        "pets": "array"
      },
      "auth_required": true,
      "logic": "Queries pets table filtered by status field, returns array of matching pets"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/findByTags",
      "description": "Finds pets by tags",
      "query_params": [
        "tags"
      ],
      "response": {
        "pets": "array"
      },
      "auth_required": true,
      "logic": "Joins pets with pet_tags and tags tables to find pets with matching tags"
    },
    {
      "method": "GET",
      "path": "/api/v3/pet/{petId}",
      "description": "Find pet by ID",
      "response": {
        "id": "number",
        "name": "string",
        "category": "object",
        "photoUrls": "array",
        "tags": "array",
        "status": "string"
      },
      "logic": "Retrieves single pet by primary key with related category and tags data"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}",
      "description": "Updates a pet in the store with form data",
      "request_body": {
        "name": "string",
        "status": "string"
      },
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Updates pet name and status fields for specified pet ID"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/pet/{petId}",
      "description": "Deletes a pet",
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Removes pet record and associated pet_tags relationships from database"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}/uploadImage",
      "description": "Uploads an image",
      "request_body": {
        "additionalMetadata": "string",
        "file": "binary"
      },
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Handles file upload for pet images, updates photoUrls array in pet record"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/inventory",
      "description": "Returns pet inventories by status",
      "response": {
        "available": "number",
        "pending": "number",
        "sold": "number"
      },
      "auth_required": true,
      "logic": "Aggregates count of pets grouped by status field"
    },
    {
      "method": "POST",
      "path": "/api/v3/store/order",
      "description": "Place an order for a pet",
      "request_body": {
        "petId": "number",
        "quantity": "number",
        "shipDate": "string",
        "status": "string",
        "complete": "boolean"
      },
      "response": {
        "id": "number",
        "petId": "number",
        "quantity": "number",
        "shipDate": "string",
        "status": "string",
        "complete": "boolean"
      },
      "logic": "Creates new order record with auto-increment ID, references pet via foreign key"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/order/{orderId}",
      "description": "Find purchase order by ID",
      "response": {
        "id": "number",
        "petId": "number",
        "quantity": "number",
        "shipDate": "string",
        "status": "string",
        "complete": "boolean"
      },
      "logic": "Retrieves single order by primary key ID"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/store/order/{orderId}",
      "description": "Delete purchase order by ID",
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "logic": "Removes order record from database by ID"
    },
    {
      "method": "POST",
      "path": "/api/v3/user",
      "description": "Create user",
      "request_body": {
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "number"
      },
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "logic": "Creates new user record with auto-increment ID, validates unique username and email"
    },
    {
      "method": "POST",
      "path": "/api/v3/user/createWithList",
      "description": "Creates list of users with given input array",
      "request_body": {
        "users": "array"
      },
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "logic": "Bulk insert multiple user records from array input"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/login",
      "description": "Logs user into the system",
      "query_params": [
        "username",
        "password"
      ],
      "response": {
        "token": "string",
        "expires": "string"
      },
      "logic": "Validates username/password against users table, generates auth token"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/logout",
      "description": "Logs out current logged in user session",
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Invalidates current user session/token"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/{username}",
      "description": "Get user by user name",
      "response": {
        "id": "number",
        "username": "string",
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "number"
      },
      "logic": "Retrieves single user by username field"
    },
    {
      "method": "PUT",
      "path": "/api/v3/user/{username}",
      "description": "Updated user",
      "request_body": {
        "firstName": "string",
        "lastName": "string",
        "email": "string",
        "password": "string",
        "phone": "string",
        "userStatus": "number"
      },
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Updates user record fields for specified username"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/user/{username}",
      "description": "Delete user",
      "response": {
        "code": "number",
        "type": "string",
        "message": "string"
      },
      "auth_required": true,
      "logic": "Removes user record from database by username"
    }
  ],
  "database": {
    "tables": [
      {
        "name": "pets",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL"
          },
          {
            "name": "category_id",
            "type": "INTEGER",
            "constraints": "REFERENCES categories(id)"
          },
          {
            "name": "photo_urls",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "status",
            "type": "TEXT",
            "constraints": "CHECK (status IN ('available', 'pending', 'sold'))"
          }
        ]
      },
      {
        "name": "categories",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL"
          }
        ]
      },
      {
        "name": "tags",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "name",
            "type": "TEXT",
            "constraints": "NOT NULL"
          }
        ]
      },
      {
        "name": "pet_tags",
        "fields": [
          {
            "name": "pet_id",
            "type": "INTEGER",
            "constraints": "REFERENCES pets(id) ON DELETE CASCADE"
          },
          {
            "name": "tag_id",
            "type": "INTEGER",
            "constraints": "REFERENCES tags(id) ON DELETE CASCADE"
          },
          {
            "name": "",
            "type": "",
            "constraints": "PRIMARY KEY (pet_id, tag_id)"
          }
        ]
      },
      {
        "name": "orders",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "pet_id",
            "type": "INTEGER",
            "constraints": "REFERENCES pets(id)"
          },
          {
            "name": "quantity",
            "type": "INTEGER",
            "constraints": "DEFAULT 1"
          },
          {
            "name": "ship_date",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "status",
            "type": "TEXT",
            "constraints": "CHECK (status IN ('placed', 'approved', 'delivered'))"
          },
          {
            "name": "complete",
            "type": "INTEGER",
            "constraints": "DEFAULT 0 CHECK (complete IN (0, 1))"
          },
          {
            "name": "user_id",
            "type": "INTEGER",
            "constraints": "",
            "foreign_key": "users.id"
          }
        ]
      },
      {
        "name": "users",
        "fields": [
          {
            "name": "id",
            "type": "INTEGER",
            "constraints": "PRIMARY KEY AUTOINCREMENT"
          },
          {
            "name": "username",
            "type": "TEXT",
            "constraints": "NOT NULL UNIQUE"
          },
          {
            "name": "first_name",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "last_name",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "email",
            "type": "TEXT",
            "constraints": "UNIQUE"
          },
          {
            "name": "password",
            "type": "TEXT",
            "constraints": "NOT NULL"
          },
          {
            "name": "phone",
            "type": "TEXT",
            "constraints": ""
          },
          {
            "name": "user_status",
            "type": "INTEGER",
            "constraints": "DEFAULT 0"
          },
          {
            "name": "role",
            "type": "TEXT",
            "constraints": "",
            "default": "customer"
          }
        ]
      }
    ]
  },
  "business_requirements": {
    "schema_changes": {
      "users": {
        "add_fields": [
          {
            "name": "role",
            "type": "TEXT",
            "default": "customer",
            "reason": "Required for role-based access control. Values: guest, customer, store_owner, admin"
          }
        ]
      },
      "orders": {
        "add_fields": [
          {
            "name": "user_id",
            "type": "INTEGER",
            "foreign_key": "users.id",
            "not_null": true,
            "reason": "Required to track order ownership and enforce customer access controls"
          }
        ]
      }
    },
    "auth_config": {
      "enabled": true,
      "method": "jwt",
      "secret_env_var": "JWT_SECRET",
      "token_expiry": "24h",
      "token_payload": [
        "user_id",
        "username",
        "role"
      ],
      "password_hashing": "bcrypt",
      "login_endpoint": "GET /api/v3/user/login",
      "register_endpoint": "POST /api/v3/user",
      "logout_endpoint": "GET /api/v3/user/logout",
      "auth_required_for_writes": true
    },
    "roles": {
      "guest": {
        "description": "Unauthenticated user",
        "permissions": [
          "browse_pets",
          "view_inventory",
          "view_pet_details"
        ]
      },
      "customer": {
        "description": "Registered user who can place orders",
        "permissions": [
          "place_orders",
          "view_own_orders",
          "cancel_own_placed_orders",
          "manage_own_profile",
          "browse_pets",
          "view_inventory"
        ]
      },
      "store_owner": {
        "description": "Store employee who manages pets and orders",
        "permissions": [
          "manage_pets",
          "view_all_orders",
          "approve_orders",
          "deliver_orders",
          "all_customer_permissions"
        ]
      },
      "admin": {
        "description": "System administrator with full access",
        "permissions": [
          "all",
          "manage_users",
          "delete_users",
          "change_user_roles",
          "relist_sold_pets",
          "reverse_pet_status_transitions"
        ]
      }
    },
    "endpoint_auth": [
      {
        "method": "POST",
        "path": "/api/v3/pet",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can add pets"
      },
      {
        "method": "PUT",
        "path": "/api/v3/pet",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "special_checks": [
          "admin_required_for_sold_to_available_transition"
        ],
        "reason": "Only store_owner or admin can edit pets, admin required for status reversals"
      },
      {
        "method": "POST",
        "path": "/api/v3/pet/{petId}",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "special_checks": [
          "admin_required_for_sold_to_available_transition"
        ],
        "reason": "Only store_owner or admin can update pets"
      },
      {
        "method": "DELETE",
        "path": "/api/v3/pet/{petId}",
        "auth_required": true,
        "allowed_roles": [
          "store_owner",
          "admin"
        ],
        "reason": "Only store_owner or admin can delete pets"
      },
      {
        "method": "POST",
        "path": "/api/v3/store/order",
        "auth_required": true,
        "allowed_roles": [
          "customer",
          "store_owner",
          "admin"
        ],
        "reason": "Must be authenticated to place orders"
      },
      {
        "method": "GET",
        "path": "/api/v3/store/order/{orderId}",
        "auth_required": true,
        "ownership_check": {
          "resource": "order",
          "owner_field": "user_id",
          "bypass_roles": [
            "store_owner",
            "admin"
          ]
        },
        "reason": "Customers can only view their own orders"
      },
      {
        "method": "DELETE",
        "path": "/api/v3/store/order/{orderId}",
        "auth_required": true,
        "ownership_check": {
          "resource": "order",
          "owner_field": "user_id",
          "bypass_roles": [
            "store_owner",
            "admin"
          ]
        },
        "reason": "Customers can only cancel their own orders"
      },
      {
        "method": "GET",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "ownership_check": {
          "resource": "user",
          "owner_field": "username",
          "bypass_roles": [
            "admin"
          ]
        },
        "reason": "Users can only view their own profile"
      },
      {
        "method": "PUT",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "ownership_check": {
          "resource": "user",
          "owner_field": "username",
          "bypass_roles": [
            "admin"
          ]
        },
        "special_checks": [
          "admin_required_for_role_changes"
        ],
        "reason": "Users can only edit their own profile, admin required for role changes"
      },
      {
        "method": "DELETE",
        "path": "/api/v3/user/{username}",
        "auth_required": true,
        "allowed_roles": [
          "admin"
        ],
        "reason": "Only admin can delete users"
      }
    ],
    "state_transitions": [
      {
        "trigger": {
          "action": "create",
          "resource": "order"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "pending"
        },
        "condition": "pet.status == 'available'",
        "reason": "Placing an order changes pet status to pending"
      },
      {
        "trigger": {
          "action": "delete",
          "resource": "order",
          "when": "status == 'placed'"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "available"
        },
        "reason": "Cancelling a placed order returns pet to available status"
      },
      {
        "trigger": {
          "action": "update",
          "resource": "order",
          "when": "status becomes 'delivered'"
        },
        "effect": {
          "resource": "pet",
          "field": "status",
          "value": "sold"
        },
        "reason": "Delivering order marks pet as sold"
      }
    ],
    "validation_rules": [
      {
        "endpoint": "POST /api/v3/store/order",
        "validations": [
          {
            "field": "petId",
            "check": "pet.status == 'available'",
            "error": "Pet is not available for purchase",
            "status_code": 400
          },
          {
            "field": "quantity",
            "check": "value == 1",
            "error": "Quantity must be 1 for live animals",
            "status_code": 400
          },
          {
            "field": "petId",
            "check": "no existing active orders for this pet",
            "error": "Pet already has an active order",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "PUT /api/v3/pet",
        "validations": [
          {
            "field": "status",
            "check": "valid_status_transition(current_status, new_status, user_role)",
            "error": "Invalid status transition. Admin required to change sold pets back to available.",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "POST /api/v3/pet/{petId}",
        "validations": [
          {
            "field": "status",
            "check": "valid_status_transition(current_status, new_status, user_role)",
            "error": "Invalid status transition. Admin required to change sold pets back to available.",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "DELETE /api/v3/store/order/{orderId}",
        "validations": [
          {
            "field": "status",
            "check": "order.status == 'placed'",
            "error": "Cannot cancel order that has been approved or delivered",
            "status_code": 400
          }
        ]
      }
    ],
    "pre_conditions": [
      {
        "endpoint": "DELETE /api/v3/pet/{petId}",
        "checks": [
          {
            "query": "SELECT COUNT(*) FROM orders WHERE pet_id = ? AND status IN ('placed', 'approved')",
            "condition": "count == 0",
            "error": "Cannot delete pet with active orders",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "DELETE /api/v3/user/{username}",
        "checks": [
          {
            "query": "SELECT COUNT(*) FROM orders WHERE user_id = (SELECT id FROM users WHERE username = ?) AND status IN ('placed', 'approved')",
            "condition": "count == 0",
            "error": "Cannot delete user with active orders",
            "status_code": 400
          }
        ]
      },
      {
        "endpoint": "PUT /api/v3/store/order/{orderId}",
        "checks": [
          {
            "query": "SELECT status FROM orders WHERE id = ?",
            "condition": "status != 'delivered'",
            "error": "Cannot modify delivered orders",
            "status_code": 400
          }
        ]
      }
    ]
  },
  "auth_config": {
    "enabled": true,
    "method": "jwt",
    "secret_env_var": "JWT_SECRET",
    "token_expiry": "24h",
    "token_payload": [
      "user_id",
      "username",
      "role"
    ],
    "password_hashing": "bcrypt",
    "login_endpoint": "GET /api/v3/user/login",
    "register_endpoint": "POST /api/v3/user",
    "logout_endpoint": "GET /api/v3/user/logout",
    "auth_required_for_writes": true
  },
  "roles": {
    "guest": {
      "description": "Unauthenticated user",
      "permissions": [
        "browse_pets",
        "view_inventory",
        "view_pet_details"
      ]
    },
    "customer": {
      "description": "Registered user who can place orders",
      "permissions": [
        "place_orders",
        "view_own_orders",
        "cancel_own_placed_orders",
        "manage_own_profile",
        "browse_pets",
        "view_inventory"
      ]
    },
    "store_owner": {
      "description": "Store employee who manages pets and orders",
      "permissions": [
        "manage_pets",
        "view_all_orders",
        "approve_orders",
        "deliver_orders",
        "all_customer_permissions"
      ]
    },
    "admin": {
      "description": "System administrator with full access",
      "permissions": [
        "all",
        "manage_users",
        "delete_users",
        "change_user_roles",
        "relist_sold_pets",
        "reverse_pet_status_transitions"
      ]
    }
  },
  "endpoint_auth": [
    {
      "method": "POST",
      "path": "/api/v3/pet",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can add pets"
    },
    {
      "method": "PUT",
      "path": "/api/v3/pet",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "special_checks": [
        "admin_required_for_sold_to_available_transition"
      ],
      "reason": "Only store_owner or admin can edit pets, admin required for status reversals"
    },
    {
      "method": "POST",
      "path": "/api/v3/pet/{petId}",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "special_checks": [
        "admin_required_for_sold_to_available_transition"
      ],
      "reason": "Only store_owner or admin can update pets"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/pet/{petId}",
      "auth_required": true,
      "allowed_roles": [
        "store_owner",
        "admin"
      ],
      "reason": "Only store_owner or admin can delete pets"
    },
    {
      "method": "POST",
      "path": "/api/v3/store/order",
      "auth_required": true,
      "allowed_roles": [
        "customer",
        "store_owner",
        "admin"
      ],
      "reason": "Must be authenticated to place orders"
    },
    {
      "method": "GET",
      "path": "/api/v3/store/order/{orderId}",
      "auth_required": true,
      "ownership_check": {
        "resource": "order",
        "owner_field": "user_id",
        "bypass_roles": [
          "store_owner",
          "admin"
        ]
      },
      "reason": "Customers can only view their own orders"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/store/order/{orderId}",
      "auth_required": true,
      "ownership_check": {
        "resource": "order",
        "owner_field": "user_id",
        "bypass_roles": [
          "store_owner",
          "admin"
        ]
      },
      "reason": "Customers can only cancel their own orders"
    },
    {
      "method": "GET",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "ownership_check": {
        "resource": "user",
        "owner_field": "username",
        "bypass_roles": [
          "admin"
        ]
      },
      "reason": "Users can only view their own profile"
    },
    {
      "method": "PUT",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "ownership_check": {
        "resource": "user",
        "owner_field": "username",
        "bypass_roles": [
          "admin"
        ]
      },
      "special_checks": [
        "admin_required_for_role_changes"
      ],
      "reason": "Users can only edit their own profile, admin required for role changes"
    },
    {
      "method": "DELETE",
      "path": "/api/v3/user/{username}",
      "auth_required": true,
      "allowed_roles": [
        "admin"
      ],
      "reason": "Only admin can delete users"
    }
  ],
  "state_transitions": [
    {
      "trigger": {
        "action": "create",
        "resource": "order"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "pending"
      },
      "condition": "pet.status == 'available'",
      "reason": "Placing an order changes pet status to pending"
    },
    {
      "trigger": {
        "action": "delete",
        "resource": "order",
        "when": "status == 'placed'"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "available"
      },
      "reason": "Cancelling a placed order returns pet to available status"
    },
    {
      "trigger": {
        "action": "update",
        "resource": "order",
        "when": "status becomes 'delivered'"
      },
      "effect": {
        "resource": "pet",
        "field": "status",
        "value": "sold"
      },
      "reason": "Delivering order marks pet as sold"
    }
  ],
  "validation_rules": [
    {
      "endpoint": "POST /api/v3/store/order",
      "validations": [
        {
          "field": "petId",
          "check": "pet.status == 'available'",
          "error": "Pet is not available for purchase",
          "status_code": 400
        },
        {
          "field": "quantity",
          "check": "value == 1",
          "error": "Quantity must be 1 for live animals",
          "status_code": 400
        },
        {
          "field": "petId",
          "check": "no existing active orders for this pet",
          "error": "Pet already has an active order",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "PUT /api/v3/pet",
      "validations": [
        {
          "field": "status",
          "check": "valid_status_transition(current_status, new_status, user_role)",
          "error": "Invalid status transition. Admin required to change sold pets back to available.",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "POST /api/v3/pet/{petId}",
      "validations": [
        {
          "field": "status",
          "check": "valid_status_transition(current_status, new_status, user_role)",
          "error": "Invalid status transition. Admin required to change sold pets back to available.",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "DELETE /api/v3/store/order/{orderId}",
      "validations": [
        {
          "field": "status",
          "check": "order.status == 'placed'",
          "error": "Cannot cancel order that has been approved or delivered",
          "status_code": 400
        }
      ]
    }
  ],
  "pre_conditions": [
    {
      "endpoint": "DELETE /api/v3/pet/{petId}",
      "checks": [
        {
          "query": "SELECT COUNT(*) FROM orders WHERE pet_id = ? AND status IN ('placed', 'approved')",
          "condition": "count == 0",
          "error": "Cannot delete pet with active orders",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "DELETE /api/v3/user/{username}",
      "checks": [
        {
          "query": "SELECT COUNT(*) FROM orders WHERE user_id = (SELECT id FROM users WHERE username = ?) AND status IN ('placed', 'approved')",
          "condition": "count == 0",
          "error": "Cannot delete user with active orders",
          "status_code": 400
        }
      ]
    },
    {
      "endpoint": "PUT /api/v3/store/order/{orderId}",
      "checks": [
        {
          "query": "SELECT status FROM orders WHERE id = ?",
          "condition": "status != 'delivered'",
          "error": "Cannot modify delivered orders",
          "status_code": 400
        }
      ]
    }
  ],
  "workflows": [
    {
      "name": "customer_successful_purchase_flow",
      "description": "Happy path: Customer logs in, browses pets, places order for available pet",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Customer views available pet",
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{available_pet_id}}",
              "status": "available"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order for available pet",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "petId": "{{available_pet_id}}",
              "quantity": 1,
              "status": "placed",
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to pending",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        }
      ]
    },
    {
      "name": "store_owner_order_approval_flow",
      "description": "Happy path: Store owner approves and delivers customer order",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Store owner logs in",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in to place order",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/store/order/{{order_id}}",
          "description": "Store owner approves order",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "status": "approved"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "approved"
            }
          }
        },
        {
          "action": "PUT /api/v3/store/order/{{order_id}}",
          "description": "Store owner marks order as delivered",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "status": "delivered"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "delivered"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to sold",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "sold"
            }
          }
        }
      ]
    },
    {
      "name": "admin_pet_management_flow",
      "description": "Happy path: Admin creates pet, manages inventory, and re-lists sold pet",
      "category": "happy_path",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Admin logs in",
          "query": {
            "username": "{{admin_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:admin_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/pet",
          "description": "Admin creates new pet",
          "headers": {
            "Authorization": "Bearer {{admin_token}}"
          },
          "body": {
            "name": "Test Dog",
            "status": "available",
            "category": {
              "id": 1,
              "name": "Dogs"
            },
            "photoUrls": [
              "https://example.com/dog.jpg"
            ]
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "name": "Test Dog",
              "status": "available",
              "id": "{{save:new_pet_id}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Admin changes sold pet back to available",
          "headers": {
            "Authorization": "Bearer {{admin_token}}"
          },
          "body": {
            "id": "{{sold_pet_id}}",
            "name": "Previously Sold Pet",
            "status": "available",
            "category": {
              "id": 1,
              "name": "Dogs"
            },
            "photoUrls": [
              "https://example.com/dog.jpg"
            ]
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        }
      ]
    },
    {
      "name": "customer_cannot_manage_pets",
      "description": "Authorization test: Customer cannot create, update, or delete pets",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/pet",
          "description": "Customer attempts to create pet (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "name": "Unauthorized Pet",
            "status": "available",
            "category": {
              "id": 1,
              "name": "Dogs"
            },
            "photoUrls": [
              "https://example.com/dog.jpg"
            ]
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Customer attempts to update pet (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "id": "{{available_pet_id}}",
            "name": "Updated Pet Name",
            "status": "available",
            "category": {
              "id": 1,
              "name": "Dogs"
            },
            "photoUrls": [
              "https://example.com/dog.jpg"
            ]
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "DELETE /api/v3/pet/{{available_pet_id}}",
          "description": "Customer attempts to delete pet (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 403
          }
        }
      ]
    },
    {
      "name": "guest_cannot_place_orders",
      "description": "Authorization test: Unauthenticated users cannot place orders",
      "category": "authorization",
      "steps": [
        {
          "action": "POST /api/v3/store/order",
          "description": "Guest attempts to place order without authentication",
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 401
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Guest can view pet details (allowed)",
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{available_pet_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/store/inventory",
          "description": "Guest can view inventory (allowed)",
          "expect": {
            "status": 200
          }
        }
      ]
    },
    {
      "name": "customer_ownership_restrictions",
      "description": "Authorization test: Customers can only view their own orders",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "First customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer1_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "First customer places order",
          "headers": {
            "Authorization": "Bearer {{customer1_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:customer1_order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Second customer logs in",
          "query": {
            "username": "customer2",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer2_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/store/order/{{customer1_order_id}}",
          "description": "Second customer attempts to view first customer's order (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer2_token}}"
          },
          "expect": {
            "status": 403
          }
        },
        {
          "action": "GET /api/v3/store/order/{{customer1_order_id}}",
          "description": "First customer can view own order",
          "headers": {
            "Authorization": "Bearer {{customer1_token}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{customer1_order_id}}"
            }
          }
        }
      ]
    },
    {
      "name": "cannot_order_unavailable_pet",
      "description": "Validation test: Cannot order pets that are not available",
      "category": "validation",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Attempt to order pending pet (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{pending_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Pet is not available for purchase"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Attempt to order sold pet (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{sold_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Pet is not available for purchase"
            }
          }
        }
      ]
    },
    {
      "name": "quantity_must_be_one",
      "description": "Validation test: Order quantity must be exactly 1 for live animals",
      "category": "validation",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Attempt to order multiple pets (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 2,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Quantity must be 1 for live animals"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Attempt to order zero pets (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 0,
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Quantity must be 1 for live animals"
            }
          }
        }
      ]
    },
    {
      "name": "pet_status_transitions_on_order_lifecycle",
      "description": "State transition test: Pet status changes through order lifecycle",
      "category": "state_transition",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Store owner logs in",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet is initially available",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to pending after order",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        },
        {
          "action": "PUT /api/v3/store/order/{{order_id}}",
          "description": "Store owner delivers order",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "status": "delivered"
          },
          "expect": {
            "status": 200
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet status changed to sold after delivery",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "sold"
            }
          }
        }
      ]
    },
    {
      "name": "order_cancellation_returns_pet_to_available",
      "description": "State transition test: Cancelled orders return pets to available status",
      "category": "state_transition",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet is pending",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "pending"
            }
          }
        },
        {
          "action": "DELETE /api/v3/store/order/{{order_id}}",
          "description": "Customer cancels order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 200
          }
        },
        {
          "action": "GET /api/v3/pet/{{available_pet_id}}",
          "description": "Verify pet returned to available after cancellation",
          "expect": {
            "status": 200,
            "body_contains": {
              "status": "available"
            }
          }
        }
      ]
    },
    {
      "name": "cannot_delete_pet_with_active_orders",
      "description": "Pre-condition test: Cannot delete pets that have active orders",
      "category": "error_handling",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Store owner logs in",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order for pet",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "DELETE /api/v3/pet/{{available_pet_id}}",
          "description": "Attempt to delete pet with active order (should fail)",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Cannot delete pet with active orders"
            }
          }
        }
      ]
    },
    {
      "name": "store_owner_cannot_relist_sold_pets",
      "description": "Authorization test: Only admin can change sold pets back to available",
      "category": "authorization",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Store owner logs in",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/pet",
          "description": "Store owner attempts to change sold pet to available (should fail)",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "id": "{{sold_pet_id}}",
            "name": "Previously Sold Pet",
            "status": "available",
            "category": {
              "id": 1,
              "name": "Dogs"
            },
            "photoUrls": [
              "https://example.com/dog.jpg"
            ]
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Invalid status transition. Admin required to change sold pets back to available."
            }
          }
        }
      ]
    },
    {
      "name": "cannot_modify_delivered_orders",
      "description": "Pre-condition test: Delivered orders cannot be modified or cancelled",
      "category": "error_handling",
      "steps": [
        {
          "action": "GET /api/v3/user/login",
          "description": "Customer logs in",
          "query": {
            "username": "{{customer_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:customer_token}}"
            }
          }
        },
        {
          "action": "GET /api/v3/user/login",
          "description": "Store owner logs in",
          "query": {
            "username": "{{store_owner_username}}",
            "password": "{{test_password}}"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "token": "{{save:store_owner_token}}"
            }
          }
        },
        {
          "action": "POST /api/v3/store/order",
          "description": "Customer places order",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "body": {
            "petId": "{{available_pet_id}}",
            "quantity": 1,
            "status": "placed"
          },
          "expect": {
            "status": 200,
            "body_contains": {
              "id": "{{save:order_id}}"
            }
          }
        },
        {
          "action": "PUT /api/v3/store/order/{{order_id}}",
          "description": "Store owner delivers order",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "status": "delivered"
          },
          "expect": {
            "status": 200
          }
        },
        {
          "action": "DELETE /api/v3/store/order/{{order_id}}",
          "description": "Attempt to cancel delivered order (should fail)",
          "headers": {
            "Authorization": "Bearer {{customer_token}}"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Cannot cancel order that has been approved or delivered"
            }
          }
        },
        {
          "action": "PUT /api/v3/store/order/{{order_id}}",
          "description": "Attempt to modify delivered order (should fail)",
          "headers": {
            "Authorization": "Bearer {{store_owner_token}}"
          },
          "body": {
            "status": "placed"
          },
          "expect": {
            "status": 400,
            "body_contains": {
              "message": "Cannot modify delivered orders"
            }
          }
        }
      ]
    }
  ]
}